# hledger-vega

Chart your hledger data with interactive graphs.

I've tried many different approaches to generating graphs, from vanilla gnuplot
to postprocessing in R with ggplot2.
They were all either too limiting, or required too much maintenance to keep
working.
I wanted to keep the interface as close as possible to running a hledger
command, so it would be as accessible as possible for others, while maintaining
customisability.
There's a long way to go to meet all these goals, but I think this is a good
start.

This requires a basic webserver running on your computer to execute the vega
specifications.

Suggestions for how to make this more accessible and useful are very welcome.

## Basic workflow

This project uses a combination of [vega-lite](https://vega.github.io/vega-lite/)
specifications, hledger arg files, and report files to generate the graphs.
Each graph requires a JSON file giving the vega-lite specification, which are
then embedded in an html file.
Each graph takes its data from a CSV file which is the result of one or more
hledger calls.
Each CSV file is generated by a report file which lists the arg files to be
used in that report, optionally along with a label to be used for the data.
The arg files are usual [hledger arg files](https://hledger.org/hledger.html#command-arguments).

## Customising your reports

There are a few places you will need to update to customise your reports.
The first step is to write a vega-lite specification for any graphs you want.
See the example JSON files here for things you can do.
Next, make sure your JSON file is embedded in `index.html`.
Finally, make sure the data files are being generated by writing an appropriate report file and arg files.

### Examples

#### Cashflow

This generates a cashflow graph, plotting revenues and expenses over time.
Since these are point expenses, it's useful to keep a running average instead
of plotting the numbers directly.
The example here averages all numbers over the last 14 days and scales up to weekly expenses.
It then plots them against time.
This is specified in [cashflow.json](cashflow.json).

Next, we need to define the data to be plotted.
This is specified in [reports/cashflow.report](reports/cashflow.report), where we specify three data series:
- `expenses`, labelled “Total expenses”
- `revenue`, labelled “Total revenue”
- `repayments`, labelled “Expenses and repayments”
The hledger command to generate these data points are specified in the
corresponding arg files:
[expenses.args](reports/expenses.args),
[revenue.args](reports/revenue.args),
and [repayments](reports/repayments.args).

Finally, to generate the data files, run the bash script [hledger-vega](hledger-vega).
This will process the report files, run the necessary hledger commands, and
place the generated csv files in the `data` directory.
